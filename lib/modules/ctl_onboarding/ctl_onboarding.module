<?php

/**
 * Implements hook_menu().
 */
function ctl_onboarding_menu() {
  $items['registration'] = array(
    'title'            => 'Training Session Registration',
    'page callback'    => '_ctl_onboarding_registration_page',
    // 'page arguments'   => array(1),

    'access callback' => TRUE,
    // 'access arguments' => array('access all course reports'),

    'type'             => MENU_CALLBACK,
    'file'             => 'includes/registration.inc',
  );

  $items['admin/config/ctl-onboarding'] = array(
    'title'            => 'CTL Onboarding Configuration',
    'page callback'    => 'drupal_get_form',
    'page arguments'   => array('_ctl_onboarding_settings_form'),

    'access callback' => TRUE,
    // 'access arguments' => array('administer users'),

    'type'             => MENU_NORMAL_ITEM,
    'file'             => 'includes/admin.inc',
  );

  return $items;
}


/**
 * Implements hook_theme().
 */
function ctl_onboarding_theme($existing, $type, $theme, $path) {
  return array(
    'ctl_onboarding_table' => array(
      'render element' => 'element',
    ),
  );
}


function theme_ctl_onboarding_table($variables) {
  $element     = $variables['element'];
  $slots       = $element['#options'];
  $showing_all = isset($element['#showing_all']) ? $element['#showing_all'] : FALSE;
  $header = array(
    t('Monday'),
    t('Tuesday'),
    t('Wednesday'),
    t('Thursday'),
    t('Friday'),
    t('Saturday'),
    t('Sunday'),
  );

  $days = array('m', 'tu', 'w', 'th', 'f', 'sa', 'su');
  $first_start_hour = 800;
  $last_start_hour = 1900;
  $rows = array();

  // Setup the table.
  for ($hour = $first_start_hour; $hour <= $last_start_hour; $hour += 100) {
    $row = array();
    for ($i = 0, $l = count($days); $i < $l; ++$i) {
      $slot_id = $days[$i] . '-' . $hour;
      $row[] = ($showing_all || $element[$slot_id]['#title']) ? drupal_render($element[$slot_id]) : NULL;
    }
    // Only add rows if they are not completely empty.
    $x = array_filter($row, function ($x) { return isset($x); });
    if (!empty($x)) {
      $rows[$hour] = $row;
    }
  }

  $table = theme('table', array(
    'header' => $header,
    'rows'   => $rows,
  ));

  return $table;
}


// /**
//  * Implements hook_permission().
//  */
// function ctl_onboarding_permission() {
//   return array(
//     'view certificate' => array(
//       'title' => t('View certificate'),
//       'description' => t('View the graduation certificate'),
//     ),
//     'view graduates' => array(
//       'title' => t('View graduates'),
//       'description' => t('View the list of graduates'),
//     ),
//   );
// }
